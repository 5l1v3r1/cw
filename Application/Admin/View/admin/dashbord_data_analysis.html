<extend name="public/template" />
<block name="headerlink">
	<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
	<link href="__PUBLIC__/metronic3_7/assets/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE LEVEL PLUGIN STYLES -->
	<!-- BEGIN PAGE STYLES -->
	<link href="__PUBLIC__/metronic3_7/assets/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
	<!-- END PAGE STYLES -->
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/tooltip.js"></script>
	<!-- <link href="__PUBLIC__/metronic3_7/assets/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/> -->
	<style type="text/css">
	svg {
		font-family: Sans-Serif, Arial;
	}
	.line {
	  stroke-width: 2;
	  fill: none;
	}

	.axis path {
	  stroke: black;
	}
	.text {
	  font-size: 12px;
	}

	.title-text {
	  font-size: 12px;
	}
	div.tooltip {
	  position: absolute;
	  text-align: center;
	  width: 100px;
	  height: 30px;
	  padding: 2px;
	  font: 12px sans-serif;
	  background: lightsteelblue;
	  border: 0px;
	  border-radius: 8px;
	  pointer-events: none;
	}
	.label {
	  font-size: 0.1rem;
	  text-anchor: middle;
	}
	</style>
</block>
<block name="siderbarmenu">
	<ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
		<!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
		<li class="sidebar-toggler-wrapper">
			<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
			<div class="sidebar-toggler">
			</div>
			<!-- END SIDEBAR TOGGLER BUTTON -->
		</li>
		<!-- DOC: To remove the search box from the sidebar you just need to completely remove the below "sidebar-search-wrapper" LI element -->
		<li class="sidebar-search-wrapper">
			<!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
			<!-- DOC: Apply "sidebar-search-bordered" class the below search form to have bordered search box -->
			<!-- DOC: Apply "sidebar-search-bordered sidebar-search-solid" class the below search form to have bordered & solid search box -->
			<form class="sidebar-search " action="extra_search.html" method="POST">
				<a href="javascript:;" class="remove">
				<i class="icon-close"></i>
				</a>
				<div class="input-group">
					<input type="text" class="form-control" placeholder="Search..." />
					<span class="input-group-btn">
					<a href="javascript:;" class="btn submit"><i class="icon-magnifier"></i></a>
					</span>
				</div>
			</form>
			<!-- END RESPONSIVE QUICK SEARCH FORM -->
		</li>
		<li class="start active open">
			<a href="javascript:;">
			<i class="icon-home"></i>
			<span class="title">Dashboard</span>
			<span class="selected"></span>
			<span class="arrow open"></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Dashboard/index');}">
					<i class="icon-bar-chart"></i>
					Default Dashboard</a>
				</li>
				<li class="active">
					<a href="{:U('Dashboard/showDataMoneyAnalysis');}">
					<i class="icon-bar-chart"></i>
					Data Analysis</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-basket"></i>
			<span class="title">eCommerce</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Order/showDataAnalysisPage');}">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=2');}">
					<i class="icon-bell"></i>
					<span class="badge badge-danger">{$cin}</span>
					Orders Ongoing</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=4');}">
					<i class="fa fa-warning"></i>
					<span class="badge badge-danger">{$cin1}</span>
					<font color="red">Orders Warning</font></a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=1');}">
					<i class="fa fa-lock"></i>
					Complete Orders</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=3');}">
					<i class="icon-basket"></i>
					Orders All</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
				<i class="fa fa-code"></i>
				<span class="title">Workers</span>
				<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Worker/showDataAnalysisPage');}">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Worker/workerRecommandPage');}">
						<i class="fa fa-smile-o" aria-hidden="true"></i>
						Workers Recommand
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist');}">
						<i class="fa fa-list" aria-hidden="true"></i>
						ALL Workers Workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=4');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						free workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=5');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						busy workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=2');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						Income > 0
					</a>
				</li>
				<li >
					<a href="{:U('Worker/workerlist?type=1');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						Income = 0
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=3');}">
						<i class="fa fa-user-times" aria-hidden="true"></i>
						dead workers
					</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="fa fa-wrench" aria-hidden="true"></i>
			<span class="title">Tools</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Tool/exchangeToolPage');}">
						<i class="fa fa-exchange" aria-hidden="true"></i> Transfer Tools
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-settings"></i>
			<span class="title">Configuration</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Configure/exchangelist');}">
						<i class="fa fa-line-chart" aria-hidden="true"></i>
						Exchange Rate
					</a>
				</li>
				<li>
					<a href="{:U('Configure/techlist');}">
						<i class="fa fa-microchip" aria-hidden="true"></i>
						Technologies Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/tradelist');}">
						<i class="fa fa-info-circle" aria-hidden="true"></i>
						Trade Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/shortcutlistpage');}">
						<i class="fa fa-sliders" aria-hidden="true"></i>
						Shortcut Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/tipslist');}">
						<i class="fa fa-calendar-check-o" aria-hidden="true"></i>
						Tips Conf
					</a>
				</li>

			</ul>
		</li>

	</ul>
</block>
<block name="container">
	<div class="page-content">
			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
			<!-- BEGIN STYLE CUSTOMIZER -->
			<!-- END STYLE CUSTOMIZER -->
			<!-- BEGIN PAGE HEADER-->
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="{:U('Dashboard/index');}">Home</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">Dashboard</a>
					</li>
				</ul>
			</div>
			<h3 class="page-title">
			Dashboard <small>reports & statistics</small>
			</h3>
			<!-- END PAGE HEADER-->
			<!-- BEGIN DASHBOARD STATS -->
			<div class="row">
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat blue-madison">
						<div class="visual">
							<i class="fa fa-comments"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$revenues} <i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Revenues/total
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat red-intense">
						<div class="visual">
							<i class="fa fa-bar-chart-o"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$profit} <i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Profit/total
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat green-haze">
						<div class="visual">
							<i class="fa fa-shopping-cart"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$cin}
							</div>
							<div class="desc">
								 Ongoing
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
				<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
					<div class="dashboard-stat purple-plum">
						<div class="visual">
							<i class="fa fa-globe"></i>
						</div>
						<div class="details">
							<div class="number">
								 {$ongoingprofit}<i class="fa fa-cny"></i>
							</div>
							<div class="desc">
								 Estimat
							</div>
						</div>
						<a class="more" href="javascript:;">
						View more <i class="m-icon-swapright m-icon-white"></i>
						</a>
					</div>
				</div>
			</div>
			<!-- END DASHBOARD STATS -->
			<div class="clearfix"></div>
			<div class="row">
				<div class="col-md-6 col-sm-6" style="height: 580px;">
				<!-- BEGIN PORTLET-->
					<div class="portlet light ">
						<div class="portlet-title">
							<div class="caption">
								<i class="icon-bar-chart font-green-sharp hide"></i>
								<span class="caption-subject font-green-sharp bold uppercase">Global statistic</span>
								<span class="caption-helper">global statistic...</span>
							</div>
						</div>
						<div class="portlet-body"  >
							<div class="portlet-body">
								<div class="row static-info">
									<h4>Total datas table</h4>
									<div class="table-scrollable">

										<table class="table table-hover">
										<thead>
										<tr>
											<th>
												 #
											</th>
											<th>
												 Revenues
											</th>
											<th>
												 Profit
											</th>
											<th>
												 Salary
											</th>
											<th>
												 No.Orders
											</th>
										</tr>
										</thead>
										<tbody>
										<foreach name="datas" item="vo">
											<if condition="$vo.createyear eq 'Total' ">
												<tr class="danger">
													<td>
														 {$vo.createyear}
													</td>
													<td>
														 {$vo.revenuesum}
														<br>
														<foreach name="revenuesarr" item="vi">
															 <small><i class="fa fa-check-square-o"></i> {$vi['revenues']} {$vi['moneytype']} </small>
															 <br>
														</foreach>
													</td>
													<td>
														 {$vo.profitsum}
													</td>
													<td>
														{$vo.salarysum}
													</td>
													<td>
														{$vo.ordernum}
													</td>
												</tr>
											<else />
												<tr>
													<td>
														 {$vo.createyear}
													</td>
													<td>
														 {$vo.revenuesum}
													</td>
													<td>
														 {$vo.profitsum}
													</td>
													<td>
														{$vo.salarysum}
													</td>
													<td>
														{$vo.ordernum}
													</td>
												</tr>
											</if>

										</foreach>

										</tbody>
										</table>
									</div>
								</div>
								<div class="row static-info">
									<div class="col-md-3 name">
										 Revenues (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingrevenues} <i class='fa fa-rmb'></i>
										 <br>
										 <foreach name="ongoingrevenuesarr" item="vo">
 										 <small><i class="fa fa-check-square-o"></i> {$vo['revenues']} {$vo['moneytype']} <br/></small>
 										</foreach>
									</div>
									<div class="col-md-4 name">
										 Profit (ongoing):
									</div>
									<div class="col-md-2 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingprofit}
									</div>
								</div>

								<div class="row static-info">
									<div class="col-md-3 name">
										 Profit (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingprofit} <i class='fa fa-rmb'></i>
									</div>
									<div class="col-md-3 name">
										 Salary (ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$ongoingsalary} <i class='fa fa-rmb'></i>
									</div>
								</div>
								<div class="row static-info">

								</div>
								<div class="row static-info">
									<div class="col-md-3 name">
										 No.Orders(ongoing):
									</div>
									<div class="col-md-3 value">
										 <i class="fa fa-paper-plane"></i> {$cin}
									</div>
								</div>
							</div>
						</div>
					</div>
				<!-- END PORTLET-->
			</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box green">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Months Percent of every Year statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">
									<div class="col-md-12 col-sm-12">
										<div class="input-group ">
											<select id="yearselect" class="form-control input-inline input-medium" name="yearinput">
												<option value="2018">2018</option>
												<option value="2019">2019</option>
												<option value="2020">2020</option>
												<option value="2021">2021</option>
												<option value="2022">2022</option>
												<option value="2023">2023</option>
												<option value="2024">2024</option>
												<option value="2025">2025</option>
												<option value="2026">2026</option>
												<option value="2027">2027</option>
												<option value="2028">2028</option>
												<option value="2029">2029</option>
												<option value="2030">2030</option>
											</select>
										</div>
									</div>
									<div id="profitpiechart00" style="padding: 0px;width:100%;height:490px"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="clearfix"></div>
				<div class="col-md-6 col-sm-12" >
						<div class="portlet box red">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Days of every Month statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form" style="height: 550px;">
								<div class="row">
									<div class="col-md-12 col-sm-12">
										<div class="input-group ">
											<select id="monthselect" class="form-control input-inline input-medium" name="monthinput">
												<option value="01">1 month</option>
												<option value="02">2 month</option>
												<option value="03">3 month</option>
												<option value="04">4 month</option>
												<option value="05">5 month</option>
												<option value="06">6 month</option>
												<option value="07">7 month</option>
												<option value="08">8 month</option>
												<option value="09">9 month</option>
												<option value="10">10 month</option>
												<option value="11">11 month</option>
												<option value="12">12 month</option>
											</select>
										</div>
									</div>
									<div id="daychart" style="padding: 10px; position: relative;width:100%;height: 500px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box purple">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Months of every Year statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="monthchart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box blue-hoki">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Quaters of every Year statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="qchart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-6 col-sm-12">
						<div class="portlet box blue">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Avg Profit Per Day For Month statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form">
								<div class="row">

									<div id="profitperdaychart" style="padding: 0px; position: relative;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>
				<div class="col-md-12 col-sm-12" >
						<div class="portlet box yellow">
							<div class="portlet-title">
								<div class="caption">
									<i class="fa fa-bar-chart-o"></i> Day to Day Statistic
								</div>
								<div class="tools">
									<a href="javascript:;" class="collapse" data-original-title="" title="">
									</a>
									<a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="reload" data-original-title="" title="">
									</a>
									<a href="javascript:;" class="remove" data-original-title="" title="">
									</a>
								</div>
							</div>
							<div class="portlet-body form" style="height: 600px;">
								<div class="row">
									<div class="col-md-12" >

										<div class="input-group ">
											<div class="input-group input-large date-picker input-daterange" data-date="10-11" data-date-format="mm-dd">
												<input type="text" class="form-control" name="fromdaytoday" id="daytodayfrom" />
												<span class="input-group-addon">
												to </span>
												<input type="text" class="form-control" name="todaytoday" id="daytodayto" />
											</div>
											<div class="input-group-btn input-large">
												<button class="btn red " id="daytodayreset" ><i class="fa fa-times"></i></button>
												<a class="btn yellow" id="aaa"><i class="fa fa-search"></i></a>

											</div>
										</div>
									</div>
									<div id="chart" style="padding: 0px;width:100%;height: 550px;"></div>
								</div>

							</div>
						</div>
				</div>

			</div>
			<div class="clearfix">
			</div>
		</div>
</block>
<block name="footscript">
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/select2/select2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/clockface/js/clockface.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/moment.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/quick-sidebar.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/demo.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/pages/scripts/components-pickers.js"></script>
	<script src="__PUBLIC__/data.formate.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js'></script>

	<!-- END PAGE LEVEL SCRIPTS -->
	<script>
		jQuery(document).ready(function() {
			// initiate layout and plugins
			Metronic.init(); // init metronic core components
			Layout.init(); // init current layout
			QuickSidebar.init(); // init quick sidebar
			Demo.init(); // init demo features
			ComponentsPickers.init();
        });
		/* globel date */
		var nowdate = new Date();
		/*profit percent draw*/
		/* month select handle */
		var nowyear = nowdate.getFullYear() - 1;
		//console.log(nowyear);
		get_profit_permonth_query(nowyear);

		$("#yearselect").val(nowyear);
		$("#yearselect").live('change',function(){
		//alert();
		$("#profitpiechart00").html("")
		get_profit_permonth_query($("#yearselect").val());
		//alert();

		});
		function get_profit_permonth_query(year){
				var data = {};
			    data.year = year;
				var url='__URL__/getYearProfitPercent';
				$.ajax({
					type:"post",
					url:url,
					data:data,
					dataType:"json",
					success: function aa(data) {
						//console.log(data);
						drawPieChart(data,"#profitpiechart00","count");

					}
				});
			}
		/* day to day */
		$("#aaa").click(function(){
			//alert("ccc");
			var day1 = $("input[name='fromdaytoday']").val();
			var day2 = $("input[name='todaytoday']").val();
			$("#chart").html("");
			//console.log(day1);
			//console.log(day2);
			get_daytoday_query(day1,day2);
			//console.log("123");

		});
		get_daytoday_query("01-01","12-31");
		$("input[name='fromdaytoday']").val("01-01");
		$("input[name='todaytoday']").val("12-31");
		function get_daytoday_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getDayToDay';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					//showstorelist(data.stores);
					var fs = '1900-'+fromdate;
					var ts = '1900-'+todate;
					var fstep = new Date(Date.parse(fs.replace(/-/g,   "/")));
					var tstep = new Date(Date.parse(ts.replace(/-/g,   "/")));
					//console.log(fstep);
					var xtformate = "%d";
					var xnum = 12;
					if(fstep.getMonth() != tstep.getMonth()){
						xtformate = "%m";
						xnum = Math.abs(fstep.getMonth() - tstep.getMonth())+1;
					}else{
						fstep.getMonth() - tstep.getMonth();
						xnum = Math.abs(fstep.getDate() - tstep.getDate())+1;
					}
					//console.log(tstep);
					var para = {mindate:fstep ,maxdate:tstep,xtformate:xtformate,xnum:xnum,ytext:"Total Profit"};
					drawLineChart(data,"#chart","profit",para);

				}
			});
		}
		/* month select handle */
		var nowmonth = nowdate.getMonth()+1;
		get_days_of_month_query(nowmonth);
		if(nowmonth<10){
			$("#monthselect").val("0"+nowmonth);
		}else
		{
			$("#monthselect").val(nowmonth);
		}
		$("#monthselect").live('change',function(){
		//alert();
		$("#daychart").html("")
		get_days_of_month_query($("#monthselect").val());
		//alert();

		});
		function get_days_of_month_query(m){
			var data = {};
			data.month = m;
			var url='__URL__/getEachMonth';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
					var fs = "1900-"+ m + "-01";
					var ts = "1900-"+ m + "-31";
					var fstep = new Date(Date.parse(fs.replace(/-/g,   "/")));
					var tstep = new Date(Date.parse(ts.replace(/-/g,   "/")));
					var xnum = 15;
					para = {mindate:fstep,maxdate:tstep,xtformate:"%d",xnum:xnum,ytext:"Total Profit"};
					drawLineChart(data,"#daychart","profit",para);
				}
			});
		}
		//drawLineChart(data,"#chart","price");
		function drawLineChart(data,chartid,attrname,para){
			//console.log(data);
			var div = d3.select("body").append("div")
				.attr("class", "tooltip")
				.style("opacity", 0);
			//console.log(data);
			var wd = $(chartid).width();
			var wh = $(chartid).height();
			var margin = {top:20, left:60, bottom:10, right:20};
			var height = wh - margin.top - margin.bottom,
				width = wd - margin.left - margin.right;
			//console.log(width);
			var duration = 50;
			var lineOpacity = "0.25";
			var lineOpacityHover = "0.85";
			var otherLinesOpacityHover = "0.1";
			var lineStroke = "1.5px";
			var lineStrokeHover = "2.5px";

			var circleOpacity = '0.85';
			var circleOpacityOnLineHover = "0.25"
			var circleRadius = 3;
			var circleRadiusHover = 6;


			/* Format Data */
			var parseDate = d3.timeParse("%m-%d");
			var keys = [];
			data.forEach(function(d) {
			  keys.push(d.name);
			  d.values.forEach(function(d) {
				d.createday = parseDate(d.createday);
				d[attrname] = +d[attrname];
			  });
			});


			/* Scale */
			var ymax = 0;
			for(var i=0;i<data.length;i++){
				var tmp_data =d3.max(data[i].values, d => d[attrname]);
				if(tmp_data > ymax){
					ymax = tmp_data
				}
			}

		    var mindate = para.mindate;
		    var maxdate = para.maxdate;
			var xScale = d3.scaleTime()
			  .domain([mindate,maxdate])
			  .range([0, width-margin.left-margin.right]);
			//console.log(d3.extent(data[0].values, d => d.createday));
			var yScale = d3.scaleLinear()
			  .domain([0, ymax])
			  .range([height-margin.top - margin.bottom, 0]);

			var color = d3.scaleOrdinal(d3.schemeCategory10);

			/* Add SVG */
			var svg = d3.select(chartid).append("svg")
			  .attr("width", (width + margin.left + margin.right)+"px")
			  .attr("height", (height+margin.top + margin.bottom)+"px")
			  .append('g')
			  .attr("transform", `translate(${margin.left}, ${margin.right})`);


			/* Add line into SVG */
			var line = d3.line()
			  .x(d => xScale(d.createday))
			  .y(d => yScale(d[attrname]))
              .curve(d3.curveCardinal);

			let lines = svg.append('g')
			  .attr('class', 'lines');

			lines.selectAll('.line-group')
			  .data(data).enter()
			  .append('g')
			  .attr('class', 'line-group')

			  .append('path')
			  .attr('class', 'line')
			  .attr('d', d => line(d.values))
			  .style('stroke', (d, i) => color(i))
			  .style('opacity', lineOpacity)
			  ;


			/* Add circles in the line */
			lines.selectAll("circle-group")
			  .data(data).enter()
			  .append("g")
			  .style("fill", (d, i) => color(i))
			  .selectAll("circle")
			  .data(d => d.values).enter()
			  .append("g")
			  .attr("class", "circle")
				.on("mouseover", function(d) {
				   div.transition()
					 .duration(200)
					 .style("opacity", .9);
				   	  div.html(d.fullcreateday+ "<br/>" +attrname + ":" +  d[attrname])
					 .style("left", (d3.event.pageX) + "px")
					 .style("top", (d3.event.pageY - 28) + "px");
				   })
				 .on("mouseout", function(d) {
				   div.transition()
					 .duration(500)
					 .style("opacity", 0);
				   })
			  .append("circle")
			  .attr("cx", d => xScale(d.createday))
			  .attr("cy", d => yScale(d[attrname]))
			  .attr("r", circleRadius)
			  .style('opacity', circleOpacity)
			  ;


			/* Add Axis into SVG */
			var xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat(para.xtformate)).ticks(para.xnum);

			var yAxis = d3.axisLeft(yScale).ticks(5);

			svg.append("g")
			  .attr("class", "x axis")
			  .attr("transform", `translate(0, ${height-margin.top-margin.bottom})`)
			  .call(xAxis);

			svg.append("g")
			  .attr("class", "y axis")
			  .call(yAxis)
			  .append('text')
			  .attr("y", 15)
			  .attr("transform", "rotate(-90)")
			  .attr("fill", "#000")
			  .text(para.ytext);
			//const keys = Object.keys(data[0]);
			const z =  d3.scaleOrdinal(d3.schemeCategory10);
			const legend = svg.append('g')
			   .attr('font-family', 'sans-serif')
			   .attr('font-size', 10)
			   .attr('text-anchor', 'end')
			   .selectAll('g')
			   .data(keys.slice())
			   .enter().append('g')
			   .attr('transform', (d, i) => 'translate(0,' + i * 20 + ')');

			legend.append('rect')
			  .attr('x', width - 19)
			  .attr('width', 10)
			  .attr('height', 10)
			  .attr('fill', z);

			legend.append('text')
			  .attr('x', width - 32)
			  .attr('y', 6)
			  .attr('dy', '0.32em')
			  .text(d => d);

		}
		get_each_month_query("0","0");
		function get_each_month_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getMonths';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {

						//para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-01-31'),xtformate:"%d"};
						//drawLineChart(data,"#daychart","profit",para)	;

						var para = {data}
						drawMultiBarChart("#monthchart",para,"month","Total Profit");

				}
			});
		}
		get_each_month_profitperday_query("0","0");
		function get_each_month_profitperday_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getMonthsProfitPerDay';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
						//console.log(data);
						//para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-01-31'),xtformate:"%d"};
						//drawLineChart(data,"#daychart","profit",para)	;
						var para = {data}
						drawMultiBarChart("#profitperdaychart",para,"month","Avg Profit Per Day For Month");

				}
			});
		}
		get_each_Q_query("0","0");
		function get_each_Q_query(fromdate,todate){
			var data = {};
			data.fromdate = fromdate;
			data.todate = todate;
			var url='__URL__/getQdatas';
			$.ajax({
				type:"post",
				url:url,
				data:data,
				dataType:"json",
				success: function aa(data) {
						//para = {mindate:new Date('1900-01-01'),maxdate:new Date('1900-01-31'),xtformate:"%d"};
						//drawLineChart(data,"#daychart","profit",para)	;
						//console.log(data);
						var para = {data}
						drawMultiBarChart("#qchart",para,"qname","Total Profit");

				}
			});
		}
		//drawMultiBarChart("#monthchart",para);
		function drawMultiBarChart(chartname,para,kname,ytext){
			const data = para.data;
			//console.log(data);
			const keys = Object.keys(data[0]);
			if(keys.indexOf(kname)>=0){
				keys.splice(keys.indexOf(kname), 1);
			}
			//console.log(keys);
			const tip = d3.tip().html(d=> d.key+ ": "+d.value);

			var wd = $(chartname).width();
			var wh = $(chartname).height();
			var margin = {top:20, left:60, bottom:70, right:20};
			var height = wh - margin.top - margin.bottom,
				width = wd - margin.left - margin.right;
			$(chartname).html("");
			var svg = d3.select(chartname)
					.append("svg")
					.attr("height", height + margin.top + margin.bottom)
					.attr("width", width + margin.left + margin.right)
					.style("cursor","default");
			 var g = svg.append("g")
					.attr("transform","translate(" + margin.left + "," + margin.top + ")");

			svg.call(tip)

			const x0 = d3.scaleBand()
			  .rangeRound([0, width])
			  .paddingInner(.1);

			const x1 = d3.scaleBand()
			  .padding(.05);

			const y = d3.scaleLinear()
			  .rangeRound([height, 0]);

			const z =  d3.scaleOrdinal(d3.schemeCategory10);

			  x0.domain(data.map(d => d[kname]));
			  x1.domain(keys).rangeRound([0, x0.bandwidth()]);
			  y.domain([0, d3.max(data, d => d3.max(keys, key=> d[key]))]).nice();
			//console.log(d3.max(data, d => d3.max(keys, key=> d[key])));
			g.append('g')
			  .selectAll('g')
			  .data(data)
			  .enter()
			  .append('g')
			  .attr('transform', d => 'translate(' + x0(d[kname]) + ',0)')
			  .selectAll('rect')
			  .data(d => keys.map(key => {return {key: key, value: d[key]}}))
			  .enter().append('rect')
			  .attr('x', d => x1(d.key))
			  .attr('y', d => y(d.value))
			  .attr('width', x1.bandwidth()+1)
			  .attr('height', d => height - y(d.value))
			  .attr('fill', d =>  z(d.key))
			  .on('mouseover', tip.show)
			  .on('mouseout', tip.hide)

			g.append('g')
			  .attr('class', 'axis-bottom')
			  .attr('transform', 'translate(0,' + height + ')')
			  .call(d3.axisBottom(x0));

			g.append('g')
			  .attr('class', 'axis-left')
			  .call(d3.axisLeft(y).ticks(null, 's'))
			  .append('text')
			  .attr('x', 10)
			  .attr('y', y(y.ticks().pop()) + 10)
			  .attr('dy', '0.32em')
			  .attr('fill', '#000')
			  .style('transform', 'rotate(-90deg)')
			  .attr('font-weight', 'bold')
			  .attr('text-anchor', 'end')
			  .text(ytext);

			const legend = g.append('g')
			   .attr('font-family', 'sans-serif')
			   .attr('font-size', 10)
			   .attr('text-anchor', 'end')
			   .selectAll('g')
			   .data(keys.slice().reverse())
			   .enter().append('g')
			   .attr('transform', (d, i) => 'translate(0,' + i * 20 + ')');

			legend.append('rect')
			  .attr('x', width - 19)
			  .attr('width', 10)
			  .attr('height', 10)
			  .attr('fill', z);

			legend.append('text')
			  .attr('x', width - 32)
			  .attr('y', 6)
			  .attr('dy', '0.32em')
			  .text(d => d);
			}
			function drawPieChart(dataset,chartid,keyword){

					//console.log(dataset);

					var width = $(chartid).width();
					var height = $(chartid).height()*0.95;
					var radius = Math.min(width, height) / 2.5;
					var donutWidth = radius/3;
					var legendRectSize = 10;
					var legendSpacing = 2;

					var color = d3.scaleOrdinal(d3.schemeCategory20);
					var tooltip = d3.select(chartid)
					  .append('div')
					  .attr('class', 'tooltip');

					var svg = d3.select(chartid)
						.append('svg')
						.attr('width', width)
						.attr('height', height)
						.append('g')
						.attr('transform', 'translate(' + (width / 2) +  ',' + (height / 2) + ')');

					var arc = d3.arc()
						.innerRadius(radius - donutWidth)
						.outerRadius(radius);

					var pie = d3.pie()
						.value(function(d) { return d[keyword]; })
						.sort(null);
					var label = d3.arc()
						.outerRadius(radius + radius*0.1)
						.innerRadius(radius + radius*0.1);

					var path = svg.selectAll('path')
						.data(pie(dataset))
						.enter()
						.append('path')
						.attr('d', arc)
						.attr('fill', function(d, i) {
							return color(d.data.label);
						});
					var total = d3.sum(dataset.map(function(d) {
						return d[keyword];
					  }));
					svg.selectAll("text").data(pie(dataset))
					  .enter().append("text")
					  .attr("class", "label")
					  .attr("transform", function(d) { return "translate(" + label.centroid(d) + ")"; })
					  .attr("dy", "0.35em")
					  .text (function(d) { return d.data.label + ""+Math.round(1000 * d["data"][keyword] / total) / 10 + "%"; });
					var legend = svg.selectAll('.legend')
						.data(color.domain())
						.enter()
						.append('g')
						.attr('class', 'legend')
						.attr('transform', function(d, i) {
						var height = legendRectSize + legendSpacing;
						var offset =  height * color.domain().length / 2;
						var horz = -2 * legendRectSize;
						var vert = i * height - offset;
						return 'translate(' + horz + ',' + vert + ')';
						});

					legend.append('rect')
						.attr('width', legendRectSize)
						.attr('height', legendRectSize)
						.style('fill', color)
						.style('stroke', color);

					legend.append('text')
						.attr('x', legendRectSize + legendSpacing)
						.attr('y', legendRectSize - legendSpacing)
						.text(function(d) { return d; });


				}



		</script>
</block>
