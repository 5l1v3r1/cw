<extend name="public/template" />
<block name="headerlink">
	<!-- BEGIN PAGE LEVEL STYLES -->
	<link rel="stylesheet" type="text/css" href="__PUBLIC__/metronic3_7/assets/global/plugins/select2/select2.css"/>
	<link rel="stylesheet" type="text/css" href="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css"/>
	<link rel="stylesheet" type="text/css" href="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/css/datepicker.css"/>
	<!-- END PAGE LEVEL STYLES -->
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/metronic3_7/assets/admin/pages/css/pagecode.css"/>
</block>
<block name="siderbarmenu">
  <ul class="page-sidebar-menu " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200">
		<!-- DOC: To remove the sidebar toggler from the sidebar you just need to completely remove the below "sidebar-toggler-wrapper" LI element -->
		<li class="sidebar-toggler-wrapper">
			<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
			<div class="sidebar-toggler">
			</div>
			<!-- END SIDEBAR TOGGLER BUTTON -->
		</li>
		<!-- DOC: To remove the search box from the sidebar you just need to completely remove the below "sidebar-search-wrapper" LI element -->
		<li class="sidebar-search-wrapper">
			<!-- BEGIN RESPONSIVE QUICK SEARCH FORM -->
			<!-- DOC: Apply "sidebar-search-bordered" class the below search form to have bordered search box -->
			<!-- DOC: Apply "sidebar-search-bordered sidebar-search-solid" class the below search form to have bordered & solid search box -->
			<form class="sidebar-search " action="extra_search.html" method="POST">
				<a href="javascript:;" class="remove">
				<i class="icon-close"></i>
				</a>
				<div class="input-group">
					<input type="text" class="form-control" placeholder="Search..." />
					<span class="input-group-btn">
					<a href="javascript:;" class="btn submit"><i class="icon-magnifier"></i></a>
					</span>
				</div>
			</form>
			<!-- END RESPONSIVE QUICK SEARCH FORM -->
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-home"></i>
			<span class="title">Dashboard</span>
			<span class="selected"></span>
			<span class="arrow open"></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Dashboard/index');}">
					<i class="icon-bar-chart"></i>
					Default Dashboard</a>
				</li>
				<li>
					<a href="{:U('Dashboard/showDataMoneyAnalysis');}">
					<i class="icon-bar-chart"></i>
					Data Analysis</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-basket"></i>
			<span class="title">eCommerce</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Order/showDataAnalysisPage');}">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=2');}">
					<i class="icon-bell"></i>
					<span class="badge badge-danger">{$cin}</span>
					Orders Ongoing</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=4');}">
					<i class="fa fa-warning"></i>
					<span class="badge badge-danger">{$cin1}</span>
					<font color="red">Orders Warning</font></a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=1');}">
					<i class="fa fa-lock"></i>
					Complete Orders</a>
				</li>
				<li>
					<a href="{:U('Order/orderlist?flag=3');}">
					<i class="icon-basket"></i>
					Orders All</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
				<i class="fa fa-code"></i>
				<span class="title">Workers</span>
				<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Worker/showDataAnalysisPage');}">
					<i class="icon-home"></i>
					Dashboard</a>
				</li>
				<li>
					<a href="{:U('Worker/workerRecommandPage');}">
						<i class="fa fa-smile-o" aria-hidden="true"></i>
						Workers Recommand
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist');}">
						<i class="fa fa-list" aria-hidden="true"></i>
						ALL Workers Workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=4');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						free workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=5');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						busy workers
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=2');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						Income > 0
					</a>
				</li>
				<li >
					<a href="{:U('Worker/workerlist?type=1');}">
						<i class="fa fa-user-circle-o" aria-hidden="true"></i>
						Income = 0
					</a>
				</li>
				<li>
					<a href="{:U('Worker/workerlist?type=3');}">
						<i class="fa fa-user-times" aria-hidden="true"></i>
						dead workers
					</a>
				</li>
				<li>
					<a href="#">
						<i class="icon-bar-chart"></i>
						Data Analysis
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="fa fa-wrench" aria-hidden="true"></i>
			<span class="title">Tools</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Tool/exchangeToolPage');}">
						<i class="fa fa-exchange" aria-hidden="true"></i> Transfer Tools
					</a>
				</li>
			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="icon-settings"></i>
			<span class="title">Configuration</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Configure/exchangelist');}">
						<i class="fa fa-line-chart" aria-hidden="true"></i>
						Exchange Rate
					</a>
				</li>
				<li>
					<a href="{:U('Configure/techlist');}">
						<i class="fa fa-microchip" aria-hidden="true"></i>
						Technologies Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/tradelist');}">
						<i class="fa fa-info-circle" aria-hidden="true"></i>
						Trade Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/shortcutlistpage');}">
						<i class="fa fa-sliders" aria-hidden="true"></i>
						Shortcut Conf
					</a>
				</li>
				<li>
					<a href="{:U('Configure/tipslist');}">
						<i class="fa fa-calendar-check-o" aria-hidden="true"></i>
						Tips Conf
					</a>
				</li>

			</ul>
		</li>
		<li>
			<a href="javascript:;">
			<i class="fa fa-shield" aria-hidden="true"></i>
			<span class="title">Security</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li>
					<a href="{:U('Security/orderRecordPage');}">
						<i class="fa fa-list" aria-hidden="true"></i> Order Check
					</a>
				</li>
				<li >
					<a href="{:U('Security/sshRecordPage');}">
						<i class="fa fa-user-secret" aria-hidden="true"></i> SSH Check
					</a>
				</li>
			</ul>
		</li>
		<li class="start active open">
			<a href="javascript:;">
			<i class="fa fa-pie-chart" aria-hidden="true"></i>
			<span class="title">Finance</span>
			<span class="arrow "></span>
			</a>
			<ul class="sub-menu">
				<li class="active">
					<a href="{:U('Finance/assetsPage');}">
						<i class="fa fa-money" aria-hidden="true"></i> Assets Managerment
					</a>
				</li>
			</ul>
		</li>
	</ul>
</block>
<block name="container">
	<div class="page-content">
			<!-- BEGIN PAGE HEADER-->
			<h3 class="page-title">
			Assets Managerment <small>Assets Managerment</small>
			</h3>
			<div class="page-bar">
				<ul class="page-breadcrumb">
					<li>
						<i class="fa fa-home"></i>
						<a href="{:U('Dashboard/index');}">Home</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">Finance</a>
						<i class="fa fa-angle-right"></i>
					</li>
					<li>
						<a href="#">Assets Managerment</a>
						<i class="fa fa-angle-right"></i>
					</li>
				</ul>
			</div>
			<!-- END PAGE HEADER-->
			<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
					<!-- Begin: life time stats -->
					<div class="portlet">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-shopping-cart"></i>Assets Managerment
							</div>
							<div class="actions">
								<a href="{:U('Finance/assetsAddPage');}" class="btn default yellow-stripe">
									<i class="fa fa-plus"></i>
									<span class="hidden-480"> New Item </span>
								</a>
							</div>
						</div>
					</div>
					<!-- End: life time stats -->
				</div>
				<div class="col-md-12 col-sm-12" style="height: auto;">
				<!-- BEGIN PORTLET-->
					<div class="portlet light ">
						<div class="portlet-title">
							<div class="caption">
								<i class="icon-bar-chart font-green-sharp hide"></i>
								<span class="caption-subject font-green-sharp bold uppercase">Assets statistic</span>
								<span class="caption-helper">assets statistic...</span>
							</div>
						</div>
						<div class="portlet-body"  >
							<div class="portlet-body">
								<div class="row static-info">
									<div class="table-scrollable">

										<table class="table table-hover">
										<thead>
										<tr>
											<th>
												 #
											</th>
											<th>
												 Assets
											</th>
											<th>
												 Bank
											</th>
											<th>
												 Amount
											</th>
											<th>
												 Rate(%)
											</th>
											<th>
												 DateRange
											</th>
											<th>
												 Interest
											</th>
											<th>
												 CreatDate
											</th>
											<th>
												 Des
											</th>
											<th>
												 Operation
											</th>
										</tr>
										</thead>
										<tbody>
										<foreach name="assets" item="vo">
											<tr>
												<td>
													 {$vo.id}
												</td>
												<td>
													 {$vo.name}
												</td>
												<td>
													 <small>{$vo.bank}<br>{$vo.attr}</small>
												</td>
												<td>
													 <small>{$vo.amount}{$vo.moneytype}</small>
												</td>
												<td>
													 <small>{$vo.year_rate}</small>
												</td>
												<td>
													<small>{$vo.startdate}</small><br><small>{$vo.enddate}</small>
												</td>
												<td>
													<small>	{$vo.interest}</small>
												</td>
												<td>
													<small>	{$vo.createtime}</small>
												</td>

												<td>
													<small>{$vo.description}</small>
												</td>
												<td>
													<a class="btn  btn-xs red" href="{:U('Finance/editAssetsPage?id='.$vo['id'].'');}">
														<i class="fa fa-edit"></i>
													</a>
													<a class="btn btn-xs purple" href="#confirmModal{$vo['id']}" data-toggle="modal">
														<i class="fa fa-times"></i>
													</a>
													<div class="modal fade modal-overflow in" id="confirmModal{$vo['id']}" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
														<div class="modal-dialog">
															<div class="modal-content">
																<div class="modal-header">
																	<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
																	<h4 class="modal-title">Delete warning</h4>
																</div>
																<div class="modal-body">
																	<p>Are you sure to delete this Assets?</p>
																	<p>ID: {$vo['id']}</p>
																	<p>Name : {$vo['name']}</p>
																	<p>Bank : {$vo['bank']}</p>
																	<p>Amount : {$vo.amount}{$vo.moneytype}</p>
																	<p>Rate : {$vo.year_rate}</p>
																	<p>Date Range : {$vo.startdate} - {$vo.enddate}</p>

																</div>
																<div class="modal-footer">
																	<a class="btn default" data-dismiss="modal"> Cancel </a>
																	<a href="{:U('Finance/delassets?id='.$vo['id'].'');}" type="button" class="btn blue"> Delete </a>
																</div>
															</div>
															<!-- /.modal-content -->
														</div>
													<!-- /.modal-dialog -->
													</div>

												</td>
											</tr>

										</foreach>
											<tr class="danger">
												<td >
													 -
												</td>
												<td>
													 Total
												</td>
												<td>
													 -
												</td>
												<td>
													 {$total.account} RMB
												</td>
												<td>
													 -
												</td>
												<td>
													-
												</td>
												<td>
													 {$total.interest} RMB
												</td>
												<td>
													-
												</td>

												<td>

												</td>
												<td>
													{$total.total} RMB

												</td>
											</tr>

										</tbody>
										</table>
									</div>
								</div>

							</div>
						</div>
						<div class="portlet-body">
							<div class="row static-info">
								<div class="col-md-4 col-sm-4" style="height: auto;">
									<h4>
										<center>Assets on Attr statistic</center>
									</h4>
									<div id="attr" style="padding: 0px;width:90%;height: 300px;"></div>

								</div>
								<div class="col-md-4 col-sm-4" style="height: auto;">
									<h4>
										<center>Assets on Bank statistic</center>
									</h4>
									<div id="bank" style="padding: 0px;width:90%;height: 300px;"></div>
								</div>
								<div class="col-md-4 col-sm-4" style="height: auto;">
									<h4>
										<center>Assets on MoneyType statistic</center>
									</h4>
									<div id="moneytype" style="padding: 0px;width:90%;height: 300px;"></div>
								</div>
							</div>

						</div>
					</div>
				<!-- END PORTLET-->
				</div>



			</div>
			<!-- END PAGE CONTENT-->
		</div>
</block>
<block name="footscript">
	<!-- BEGIN PAGE LEVEL PLUGINS -->
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/select2/select2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js"></script>
	<script type="text/javascript" src="__PUBLIC__/metronic3_7/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
	<!-- END PAGE LEVEL PLUGINS -->
	<!-- BEGIN PAGE LEVEL SCRIPTS -->
	<script src="__PUBLIC__/metronic3_7/assets/global/scripts/metronic.js" type="text/javascript"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/layout.js" type="text/javascript"></script>
	<script src="__PUBLIC__/data.formate.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="__PUBLIC__/metronic3_7/assets/admin/layout/scripts/tooltip.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js'></script>

	<!-- END PAGE LEVEL SCRIPTS -->
	<script>
			jQuery(document).ready(function() {
           Metronic.init(); // init metronic core components
					 Layout.init(); // init current layout
			});
			get_asserts_datas("bank");
			get_asserts_datas("attr");
			get_asserts_datas("moneytype");
			function get_asserts_datas(type){
					var data = {};
				  data.type = type;
					var url='__URL__/getAssetsPercent';
					$.ajax({
						type:"post",
						url:url,
						data:data,
						dataType:"json",
						success: function aa(data) {
							//console.log(data);
							drawPieChart(data,"#"+type,"count");

						}
					});
				}
				function drawPieChart(dataset,chartid,keyword){

						console.log(dataset);

						var width = $(chartid).width();
						var height = $(chartid).height()*0.95;
						var radius = Math.min(width, height) / 2.5;
						var donutWidth = radius/3;
						var legendRectSize = 10;
						var legendSpacing = 2;

						var color = d3.scaleOrdinal(d3.schemeCategory10);
						var tooltip = d3.select(chartid)
						  .append('div')
						  .attr('class', 'tooltip');

						var svg = d3.select(chartid)
							.append('svg')
							.attr('width', width)
							.attr('height', height)
							.append('g')
							.attr('transform', 'translate(' + (width / 2) +  ',' + (height / 2) + ')');

						var arc = d3.arc()
							.innerRadius(radius - donutWidth)
							.outerRadius(radius);

						var pie = d3.pie()
							.value(function(d) { return d[keyword]; })
							.sort(null);
						var label = d3.arc()
							.outerRadius(radius + radius*0.1)
							.innerRadius(radius + radius*0.1);

						var path = svg.selectAll('path')
							.data(pie(dataset))
							.enter()
							.append('path')
							.attr('d', arc)
							.attr('fill', function(d, i) {
								return color(d.data.label);
							});
						var total = d3.sum(dataset.map(function(d) {
							return d[keyword];
						  }));
						svg.selectAll("text").data(pie(dataset))
						  .enter().append("text")
						  .attr("class", "label")
						  .attr("transform", function(d) { return "translate(" + label.centroid(d) + ")"; })
						  .attr("dy", "0.35em")
						  .text (function(d) { return d.data.label + ""+Math.round(1000 * d["data"][keyword] / total) / 10 + "%"; });
						var legend = svg.selectAll('.legend')
							.data(color.domain())
							.enter()
							.append('g')
							.attr('class', 'legend')
							.attr('transform', function(d, i) {
							var height = legendRectSize + legendSpacing;
							var offset =  height * color.domain().length / 2;
							var horz = -2 * legendRectSize;
							var vert = i * height - offset;
							return 'translate(' + horz + ',' + vert + ')';
							});

						legend.append('rect')
							.attr('width', legendRectSize)
							.attr('height', legendRectSize)
							.style('fill', color)
							.style('stroke', color);

						legend.append('text')
							.attr('x', legendRectSize + legendSpacing)
							.attr('y', legendRectSize - legendSpacing)
							.text(function(d) { return d; });


					}
		</script>
</block>
